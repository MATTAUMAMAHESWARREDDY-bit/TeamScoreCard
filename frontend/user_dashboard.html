<!DOCTYPE html>
<html>
<head>
<title>User Dashboard</title>

<style>
body{
    margin:0;
    font-family:Segoe UI, Arial;
    background:#eef1f5;
}

/* LEFT MENU */
.sidebar{
    width:240px;
    height:100vh;
    background:#1e293b;
    color:white;
    position:fixed;
}

.sidebar h2{
    text-align:center;
    padding:25px;
    border-bottom:1px solid #ffffff30;
}

.sidebar button{
    width:100%;
    padding:16px;
    border:none;
    background:none;
    color:white;
    text-align:left;
    font-size:15px;
    cursor:pointer;
}

.sidebar button:hover{
    background:#334155;
}

/* RIGHT CONTENT */
.main{
    margin-left:240px;
    padding:60px;
}

.card{
    background:white;
    width:520px;
    padding:35px;
    border-radius:16px;
    box-shadow:0 12px 25px rgba(0,0,0,0.12);
    animation:fade 0.4s;
}

@keyframes fade{
    from{opacity:0;transform:translateY(10px);}
    to{opacity:1;transform:translateY(0);}
}

.card h3{
    margin-bottom:20px;
    color:#1e293b;
}

p{
    font-size:15px;
    margin:8px 0;
}

input,button.submit{
    width:100%;
    padding:12px;
    margin:12px 0;
    border-radius:8px;
    border:1px solid #cbd5e1;
    font-size:15px;
}

button.submit{
    background:#2563eb;
    color:white;
    border:none;
    cursor:pointer;
}

button.submit:hover{
    background:#1d4ed8;
}
</style>

<script>
// -----------------------------
// Switch sections
// -----------------------------
function show(section){
    document.getElementById("profile").style.display="none";
    document.getElementById("score").style.display="none";
    document.getElementById("cert").style.display="none";
    document.getElementById(section).style.display="block";
}

// -----------------------------
// Fetch profile
// -----------------------------
async function loadProfile() {
    const regno = sessionStorage.getItem("regno");
    if(!regno) return alert("No user logged in!");

    try {
        const res = await fetch(`/get_profile/${regno}`);
        const data = await res.json();

        if(data.error){
            alert(data.error);
            return;
        }

        // fill profile
        document.getElementById("name").innerText = data.name;
        document.getElementById("teamname").innerText = data.teamname;
        document.getElementById("teamno").innerText = data.teamno;
        document.getElementById("regno").innerText = data.regno;
        document.getElementById("email").innerText = data.email;

    } catch(err){
        console.error(err);
        alert("Failed to load profile");
    }
}

// -----------------------------
// Fetch scores
// -----------------------------
async function loadScores() {
    try {
        const res = await fetch("/get_scores");
        const data = await res.json();
        const scoresDiv = document.getElementById("scoreList");
        scoresDiv.innerHTML = "";

        if(data.scores){
            data.scores.forEach(item => {
                const p = document.createElement("p");
                p.innerText = `Team ${item[0]} (${item[1]}): ${item[2]}`;
                scoresDiv.appendChild(p);
            });
        }

    } catch(err){
        console.error(err);
        alert("Failed to load scores");
    }
}

// -----------------------------
// Download certificate
// -----------------------------
function downloadCert(){
    const regno = document.getElementById("certRegno").value;
    if(!regno) return alert("Enter Register Number");
    window.location.href = `/download_certificate/${regno}`;
}

// -----------------------------
// On page load
// -----------------------------
window.onload = function(){
    loadProfile();
    loadScores();
    show('profile');
};
</script>

</head>

<body>

<!-- LEFT MENU -->
<div class="sidebar">
    <h2>User Dashboard</h2>
    <button onclick="show('profile')">Profile</button>
    <button onclick="show('score')">Watch Score</button>
    <button onclick="show('cert')">Download Certificate</button>
    <button onclick="location.href='/login'">Logout</button>
</div>

<!-- RIGHT CONTENT -->
<div class="main">

    <!-- PROFILE -->
    <div id="profile" class="card">
        <h3>User Profile</h3>
        <p>Name : <span id="name"></span></p>
        <p>Team Name : <span id="teamname"></span></p>
        <p>Team Number : <span id="teamno"></span></p>
        <p>Register Number : <span id="regno"></span></p>
        <p>Email : <span id="email"></span></p>
    </div>

    <!-- SCORE -->
    <div id="score" class="card" style="display:none">
        <h3>Team Scores</h3>
        <div id="scoreList"></div>
    </div>

    <!-- CERTIFICATE -->
    <div id="cert" class="card" style="display:none">
        <h3>Download Certificate</h3>
        <input type="text" id="certRegno" placeholder="Enter Register Number">
        <button class="submit" onclick="downloadCert()">Download</button>
    </div>

</div>

</body>
</html>
